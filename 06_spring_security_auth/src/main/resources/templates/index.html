<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <title>Auth 데모 인덱스</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<h1>Auth 데모</h1>

<hr>

<!-- 0) 회원가입 -->
<h2>회원가입</h2>
<p>POST /api/auth/signup</p>
<form id="signupForm">
    <label>아이디: <input id="signupUsername" type="text" required></label><br>
    <label>비밀번호: <input id="signupPassword" type="password" required></label><br>
    <button type="submit">회원가입</button>
</form>
<pre id="signupOut">(응답 표시)</pre>

<hr>

<!-- 1) 로그인/로그아웃 -->
<h2>로그인 / 로그아웃</h2>
<ul>
    <li><a href="/login">/login 이동</a></li>
    <li>
        <form action="/logout" method="post">
            <button type="submit">로그아웃(POST /logout)</button>
        </form>
    </li>
</ul>

<hr>

<!-- 2) 현재 로그인 상태 확인 -->
<h2>현재 로그인 상태</h2>
<p>/api/**는 인증 필요. 아래 버튼으로 /api/auth/me 호출</p>
<button id="btnMe">내 정보 보기 (GET /api/auth/me)</button>
<pre id="meOut">(응답 표시)</pre>

<hr>

<!-- 3) 탈퇴 -->
<h2>탈퇴</h2>
<p>본인 계정 삭제: DELETE /api/auth/me</p>
<button id="btnDeleteMe">내 계정 탈퇴</button>
<pre id="delOut">(응답 표시)</pre>

<hr>

<!-- 4) 관리자 기능 -->
<h2>관리자 기능 (ADMIN 권한 필요)</h2>

<h3>회원 목록 조회</h3>
<p>GET /api/admin/users</p>
<button id="btnListUsers">회원 목록 조회</button>
<pre id="listOut">(응답 표시)</pre>

<h3>회원 삭제</h3>
<p>DELETE /api/admin/users/{id}</p>
<input id="delUserId" type="number" placeholder="삭제할 사용자 ID">
<button id="btnDeleteUser">삭제</button>
<pre id="adminDelOut">(응답 표시)</pre>

<script>
    axios.defaults.withCredentials = true;

    function show(elId, res) {
        const el = document.getElementById(elId);
        if (!res) {
            el.textContent = '(응답 없음)';
            return;
        }

        const { status, data } = res;
        const prefix = status >= 400 ? '❌ 오류 ' : '✅ 성공 ';
        let body = '';

        try {
            body = JSON.stringify(data, null, 2);
        } catch {
            body = String(data);
        }

        el.textContent = prefix + '(status=' + status + ')\n' + body;
    }

    // 0) 회원가입
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('signupUsername').value.trim();
        const password = document.getElementById('signupPassword').value.trim();
        if (!username || !password) {
            show('signupOut', { status: 400, data: '입력값이 비어있습니다.' });
            return;
        }

        try {
            const res = await axios.post('/api/auth/signup', { username, password }, { validateStatus: () => true });
            show('signupOut', res);
        } catch (e) {
            show('signupOut', { status: 500, data: e?.message || e });
        }
    });

    // 2) /api/auth/me
    document.getElementById('btnMe').addEventListener('click', async () => {
        try {
            const res = await axios.get('/api/auth/me', { validateStatus: () => true });
            show('meOut', res);
        } catch (e) {
            show('meOut', { status: 500, data: e?.message || e });
        }
    });

    // 3) DELETE /api/auth/me
    document.getElementById('btnDeleteMe').addEventListener('click', async () => {
        if (!confirm('정말 탈퇴하시겠습니까?')) return;
        try {
            const res = await axios.delete('/api/auth/me', { validateStatus: () => true });
            show('delOut', res);
        } catch (e) {
            show('delOut', { status: 500, data: e?.message || e });
        }
    });

    // 4-1) GET /api/admin/users
    document.getElementById('btnListUsers').addEventListener('click', async () => {
        try {
            const res = await axios.get('/api/admin/users', { validateStatus: () => true });
            show('listOut', res);
        } catch (e) {
            show('listOut', { status: 500, data: e?.message || e });
        }
    });

    // 4-2) DELETE /api/admin/users/{id}
    document.getElementById('btnDeleteUser').addEventListener('click', async () => {
        const id = document.getElementById('delUserId').value;
        if (!id) { show('adminDelOut', { status: 400, data: 'ID를 입력하세요' }); return; }
        if (!confirm('정말 삭제하시겠습니까? id=' + id)) return;
        try {
            const res = await axios.delete('/api/admin/users/' + encodeURIComponent(id), { validateStatus: () => true });
            show('adminDelOut', res);
        } catch (e) {
            show('adminDelOut', { status: 500, data: e?.message || e });
        }
    });
</script>

</body>
</html>
